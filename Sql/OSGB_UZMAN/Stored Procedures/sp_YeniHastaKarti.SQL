BEGIN TRAN
GO
ALTER PROCEDURE [dbo].[sp_YeniHastaKarti]
@KURUM varchar(10),
@SIGORTANO varchar(20),
@CINSIYETI varchar(1),
@MEDENI varchar(1),
@HASTAADI varchar(50),
@HASTASOYADI varchar(50),
@BABAADI varchar(50),
@ANAADI varchar(50),
@EV_ADRES varchar(60),
@EV_PK varchar(8),
@EV_SEHIR varchar(20),
@EV_TEL1 varchar(15),
@EV_TEL2 varchar(15),
@EMAIL varchar(60),
@DOGUMYERI varchar(20),
@DOGUMTARIHI varchar(10),
@UYRUGU varchar(6),
@TCKIMLIKNO varchar(15),
@HUVIYETTIPI varchar(10),
@HUVIYETNO varchar(10),
@KURUMTIPI varchar(2),
@SICILNO varchar(20),
@KARNENO varchar(20),
@seans varchar(7),
@seansSaat int,
@SigortaliTur varchar(1),
@SeansTip varchar(1) = '1',
@RaporTarih varchar(10)='',
@GecerlikTarihi varchar(10)='',
@sevkEdenTesis varchar(10)='',
@sevkEdilenBrans varchar(10)='',
@sevkEdenDoktor varchar(10)='',
@muayenAcilis varchar(10)='',
@PBH varchar(50),
@KH varchar(50),
@TS varchar(50),
@DS varchar(50),
@DC varchar(50),
@YA varchar(50),
@SD varchar(50),
@D varchar(50),
@DG varchar(50),
@H varchar(50),
@Yakinlik varchar(10),
@baslangic varchar(10),
@hastaNot text,
@merkezdeBaslangic varchar(10),
@Istel1 varchar(15),
@Istel2 varchar(15),
@vyer varchar(20),
@huviyetTarih varchar(10),
@kanGrubu varchar(1),
@USER_ID varchar(20),
@DATE_CREATE varchar(20),
@raporNo varchar(20)='',
@hastaTip varchar(1),
@makinaNo varchar(3),
@idealkilo float,
@Hepatit varchar(1),
@HIV varchar(1),
@Aday varchar(1) = 'H',
@Sandalye bit = 0,
@APH varchar(10) = '',
@Na varchar(10) = '',
@Boy int,
@Tip varchar(1) = 'H',
@vatandasTip VARCHAR(1) = '0',
@HCOOO VARCHAR(5) = ''

AS

--begin tran

Declare @dosyaNo float , @dn varchar(6)

set @Dn = DBO.DOSYANOAL(0)
set @dosyano = @dn
exec sp_DosyaNoYaz @DosyaNo



INSERT INTO [HASTAKART]
 ([DOSYANO],
  [KURUM],
  [SIGORTANO],
  [CINSIYETI],
  [MEDENI],
  [HASTAADI],
  [HASTASOYADI],
  [BABAADI],
  [ANAADI],
  [EV_ADRES],
  [EV_PK],
  [EV_SEHIR],
  [EV_TEL1],
  [EV_TEL2],
  [EMAIL],
  [DOGUMYERI],
  [DOGUMTARIHI],
  [UYRUGU],
  [TCKIMLIKNO],
  [HUVIYETTIPI],
  [HUVIYETNO],
  [KurumTip],
  [SicilNo],
  [KarneNo],
  [seansGunleri],
  [seansSuresi],
  [Durum],
  [seans],
  [RaporTarihi],
  [RaporGecerlik],
  [sevkEdenTesis],
  [sevkEdilenBrans],
  [sevkEdenDoktor],
  [muayeneAcilisTarihi],
  [PBH],
  [KH],
  [TS],
  [DS],
  [DC],
  [YA],
  [SD],
  [D],
  [DG],
  [H],
  [YAKINLIK],
  [BASLANGIC],
  [hastaNot],
  [merkezdeBaslangic],
  [IS_TEL1],
  [IS_TEL2],
  [HUVIYETVYER],
  [HUVIYETTARIHI],
  [KANGRUBU],
  [USER_ID],
  [DATE_CREATE],
  [raporNo],
  [hastaTip],
  [makinaNo],
  [IdealKilo],
  [Hepatit],
  [Hiv],
  [Aday],
  [TekSandalye],
  [APH],
  [Na],
  [Boy],
  [Tip],
  [vatandasTip],
  [HCOOO] 
)
VALUES(
  @Dn,
  @KURUM,
  @SIGORTANO,
  @CINSIYETI,
  @MEDENI,
  @HASTAADI,
  @HASTASOYADI,
  @BABAADI,
  @ANAADI,
  @EV_ADRES,
  @EV_PK,
  @EV_SEHIR,
  @EV_TEL1,
  @EV_TEL2,
  @EMAIL,
  @DOGUMYERI,
  @DOGUMTARIHI,
  @UYRUGU,
  @TCKIMLIKNO,
  @HUVIYETTIPI,
  @HUVIYETNO,
  @KURUMTIPI,
  @SICILNO,
  @KARNENO,
  @seans,
  @seansSaat,
  @SigortaliTur,
  @SeansTip,
  @RaporTarih,
  @GecerlikTarihi,
  @sevkEdenTesis,
  @sevkEdilenBrans,
  @sevkEdenDoktor,
  @muayenAcilis,
  @PBH,
  @KH,
  @TS,
  @DS,
  @DC,
  @YA,
  @SD,
  @D,
  @DG,
  @H,
  @Yakinlik,
  @Baslangic,
  @hastaNot,
  @merkezdeBaslangic,
  @ISTEL1,
  @ISTEL2,
  @vyer,
  @huviyetTarih,
  @KanGrubu,
  @USER_ID,
  @DATE_CREATE,
  @raporNo,
  @hastaTip,
  @makinaNo,
  @idealKilo,
  @Hepatit,
  @HIV,
  @Aday,
  @Sandalye,
  @APH,
  @Na,
  @Boy ,
  @Tip,
  @vatandasTip,
  @HCOOO  
)


--if @@error <> 0  begin
--rollback tran
--end
--else begin
--commit tran
--end


SELECT @DOSYANO as DosyaNo
GO
exec sp_vw_sys_upd 'P ', 'dbo', 'sp_YeniHastaKarti'
GO
COMMIT
GO
